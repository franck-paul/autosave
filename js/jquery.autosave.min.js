"use strict";(()=>{const t=jQuery;t.fn.autosave=function(a){let e;a=t.extend({},t.fn.autosave.defaults,a);const s=this;return t(this).addClass("autosave"),this.on("autosave.setup",function(){a.setup.apply(s.element,[s.element,a]),t(this).trigger("autosave.record"),e=setInterval(()=>{t(s).trigger("autosave.save")},a.interval)}).on("autosave.shutdown",function(){a.shutdown.apply(this.element,[this.element,a]),clearInterval(e),1==t(this).data("autosave.dirty")&&t(this).trigger("autosave.save",[!1]),t(this).removeClass("autosave").off("autosave"),t(this).data("autosave.form",null),t(this).data("autosave.dirty",null)}).on("autosave.reset",function(){t(this).trigger("autosave.shutdown"),t(this).trigger("autosave.setup")}).on("autosave.record",function(){a.record.apply(this.element,[this.element,a]),t(this).data("autosave.dirty",!1),t(this).data("autosave.form",t(this).find(a.data).not(".autosave-ignore").serializeArray())}).on("autosave.save",function(e,o){if(!a.before.apply(s,[s,a]))return;if(!a.validate.apply(s,[s,a]))return;const i=t(this).find(a.data).not(".autosave-ignore").serializeArray();if(t.param(i)!=t.param(t(this).data("autosave.form"))&&1!=t(this).data("autosave.active")){t(this).data("autosave.active",!0);const e=e=>{t(s).data("autosave.active",!1),t(s).trigger("autosave.record"),a.save.apply(s,[s,a,e])};null!=a.url&&"function"==typeof a.url?a.url.apply(s.element,[s.element,a,i,e]):t.ajax({async:o??!0,url:null==a||null==a.url?t(this).attr("action"):a.url,type:"post",data:i,success:e})}}).trigger("autosave.setup"),this},t.fn.isDirty=function(){return 1==t(this).data("autosave.dirty")||null!=t(this).data("autosave.form")&&t.param(t(this).data("autosave.form"))!=t.param(t(this).find("input,select,textarea").not(".autosave-ignore").serializeArray())},t.fn.autosave.defaults={data:"input,select,textarea",interval:12e4,setup(){},record(){},before:()=>!0,validate(){return!("function"==typeof t.fn.validate&&!t(this).is(".ignore-validate"))||t(this).valid()},save(){},shutdown(){},dirty(){}},window.onbeforeunload=()=>{t("form.autosave").trigger("autosave.shutdown")}})();
